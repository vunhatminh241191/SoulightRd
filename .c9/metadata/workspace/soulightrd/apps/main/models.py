{"filter":false,"title":"models.py","tooltip":"/soulightrd/apps/main/models.py","undoManager":{"mark":30,"position":30,"stack":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":0},"end":{"row":3,"column":32}},"text":"class UserProfile(models.Model):"},{"action":"insertText","range":{"start":{"row":3,"column":32},"end":{"row":4,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":4,"column":0},"end":{"row":91,"column":0}},"lines":["\tuser = models.ForeignKey(User, unique=True,related_name='profile')   ","\tbasic_info = models.TextField(blank=True)","\tgender = models.CharField(max_length=1,choices=GENDER,default=\"m\")","\tavatar = models.ForeignKey(\"Photo\",blank=True,null=True,related_name=\"avatar\")","\tcover_picture = models.ForeignKey(\"Photo\",blank=True,null=True,related_name='cover_picture')","\tcity = models.CharField(max_length=50,blank=True)","\tstate = models.CharField(max_length=2,choices=USA_STATES,blank=True)","\tcountry = models.CharField(max_length=100,choices=DEFAULT_COUNTRIES_FORMAT,blank=True)","\ttimezone = models.CharField(max_length=30)","\tprivacy_status = models.CharField(max_length=1,choices=PRIVACY_STATUS,default=PUBLIC)","\tdate_of_birth = models.DateField(blank=True,null=True)","\twatchlist = models.ManyToManyField(\"Activity\",related_name=\"watchlist\",blank=True)","\tinvitations = models.ManyToManyField(\"Invitation\",related_name=\"invitation\",blank=True,null=True)","\tfacebook_id = models.CharField(max_length=40,blank=True,null=True)","\tfollowers = models.ManyToManyField(User,related_name=\"followers\",blank=True,null=True)","\tfollowing = models.ManyToManyField(User,related_name=\"following\",blank=True,null=True)","\tauthorized_account = models.CharField(max_length=100,blank=True,null=True)","\treports = models.ManyToManyField(Report,related_name='user_reports',blank=True,null=True)","","\tdef __unicode__(self):","\t\treturn unicode(self.user)","","\tdef is_facebook_account(self):","\t\tif self.facebook_id == None: return False","\t\tif len(self.facebook_id) != 0:","\t\t\treturn True","\t\treturn False","","\tdef get_user_fullname(self):","\t\tfirst_name = self.user.first_name","\t\tlast_name = self.user.last_name","\t\tif first_name.strip() == \"\" and last_name.strip() == \"\":","\t\t\tusername = self.user.username","\t\t\treturn username[0].upper() + username[1:].lower()","\t\treturn first_name + \" \" + last_name","","\tdef get_all_activity_count(self):","\t\tcreate_activities_count = Activity.objects.filter(user_create=self.user).count()","\t\tjoin_activities_count = ActivityRequest.objects.filter(user_request=self.user,request_status=\"1\").count()","\t\treturn create_activities_count + join_activities_count","","\tdef get_tickets(self):","\t\treturn TicketTransaction.objects.filter(user=self)","","\tdef get_create_locations(self):","\t\treturn Location.objects.filter(create_by=self.user)","","\tdef get_follow_locations(self):","\t\treturn Location.objects.filter(follow_by=self.user)","","\tdef get_create_activities(self):","\t\treturn Activity.objects.filter(user_create=self.user)","","\tdef get_all_upload_photos(self):","\t\treturn Photo.objects.filter(user_post=self.user,privacy_status=PUBLIC).exclude(unique_id__in=[self.avatar.unique_id,self.cover_picture.unique_id]).order_by(\"-upload_date\")","","\tdef get_all_upload_photos_count(self):","\t\treturn Photo.objects.filter(user_post=self.user,privacy_status=PUBLIC).exclude(unique_id__in=[self.avatar.unique_id,self.cover_picture.unique_id]).order_by(\"-upload_date\").count()","","\tdef get_upload_photos(self,from_index=None,to_index=None):","\t\tif from_index == None or to_index == None:","\t\t\treturn Photo.objects.filter(user_post=self.user,privacy_status=PUBLIC).exclude(unique_id__in=[self.avatar.unique_id,self.cover_picture.unique_id]).order_by(\"-upload_date\")","\t\telse:","\t\t\treturn Photo.objects.filter(user_post=self.user,privacy_status=PUBLIC).exclude(unique_id__in=[self.avatar.unique_id,self.cover_picture.unique_id]).order_by(\"-upload_date\")[from_index:to_index]","","\tdef get_join_activities(self):","\t\tresult = []","\t\tactivity_requests = ActivityRequest.objects.filter(user_request=self.user,request_status=\"1\")","\t\tfor request in activity_requests:","\t\t\tresult.append(request.activity)","\t\treturn result","","\tdef is_following(self,username):","\t\ttry:","\t\t\tuser_follow = User.objects.get(username=username)","\t\t\tfor user in self.following.all():","\t\t\t\tif user.username == user_follow.username:","\t\t\t\t\treturn True","\t\t\treturn False","\t\texcept Exception as e:","\t\t\tlogger.exception(e)","\t\treturn False","","def create_user_profile(sender, instance, created, **kwargs):","\tif created:","\t\tUserProfile.objects.create(user=instance)","\t\t"]},{"action":"insertText","range":{"start":{"row":91,"column":0},"end":{"row":91,"column":51}},"text":"post_save.connect(create_user_profile, sender=User)"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":20,"column":1},"end":{"row":20,"column":75}},"text":"authorized_account = models.CharField(max_length=100,blank=True,null=True)"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":20,"column":0},"end":{"row":20,"column":1}},"text":"\t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":19,"column":87},"end":{"row":20,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":16,"column":1},"end":{"row":16,"column":98}},"text":"invitations = models.ManyToManyField(\"Invitation\",related_name=\"invitation\",blank=True,null=True)"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":16,"column":0},"end":{"row":16,"column":1}},"text":"\t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":15,"column":83},"end":{"row":16,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":18,"column":0},"end":{"row":18,"column":87}},"text":"\tfollowing = models.ManyToManyField(User,related_name=\"following\",blank=True,null=True)"},{"action":"removeLines","range":{"start":{"row":17,"column":0},"end":{"row":18,"column":0}},"nl":"\n","lines":["\tfollowers = models.ManyToManyField(User,related_name=\"followers\",blank=True,null=True)"]},{"action":"removeText","range":{"start":{"row":16,"column":67},"end":{"row":17,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":15,"column":0},"end":{"row":15,"column":83}},"text":"\twatchlist = models.ManyToManyField(\"Activity\",related_name=\"watchlist\",blank=True)"},{"action":"removeText","range":{"start":{"row":14,"column":55},"end":{"row":15,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":12,"column":1},"end":{"row":12,"column":43}},"text":"timezone = models.CharField(max_length=30)"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":12,"column":0},"end":{"row":12,"column":1}},"text":"\t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":11,"column":87},"end":{"row":12,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":33,"column":0},"end":{"row":44,"column":0}},"nl":"\n","lines":["","\tdef get_all_activity_count(self):","\t\tcreate_activities_count = Activity.objects.filter(user_create=self.user).count()","\t\tjoin_activities_count = ActivityRequest.objects.filter(user_request=self.user,request_status=\"1\").count()","\t\treturn create_activities_count + join_activities_count","","\tdef get_tickets(self):","\t\treturn TicketTransaction.objects.filter(user=self)","","\tdef get_create_locations(self):","\t\treturn Location.objects.filter(create_by=self.user)"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":34,"column":0},"end":{"row":42,"column":0}},"nl":"\n","lines":["\tdef get_follow_locations(self):","\t\treturn Location.objects.filter(follow_by=self.user)","","\tdef get_create_activities(self):","\t\treturn Activity.objects.filter(user_create=self.user)","","\tdef get_all_upload_photos(self):","\t\treturn Photo.objects.filter(user_post=self.user,privacy_status=PUBLIC).exclude(unique_id__in=[self.avatar.unique_id,self.cover_picture.unique_id]).order_by(\"-upload_date\")"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":34,"column":0},"end":{"row":43,"column":0}},"nl":"\n","lines":["","\tdef get_all_upload_photos_count(self):","\t\treturn Photo.objects.filter(user_post=self.user,privacy_status=PUBLIC).exclude(unique_id__in=[self.avatar.unique_id,self.cover_picture.unique_id]).order_by(\"-upload_date\").count()","","\tdef get_upload_photos(self,from_index=None,to_index=None):","\t\tif from_index == None or to_index == None:","\t\t\treturn Photo.objects.filter(user_post=self.user,privacy_status=PUBLIC).exclude(unique_id__in=[self.avatar.unique_id,self.cover_picture.unique_id]).order_by(\"-upload_date\")","\t\telse:","\t\t\treturn Photo.objects.filter(user_post=self.user,privacy_status=PUBLIC).exclude(unique_id__in=[self.avatar.unique_id,self.cover_picture.unique_id]).order_by(\"-upload_date\")[from_index:to_index]"]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":40,"column":0},"end":{"row":40,"column":15}},"text":"\t\treturn result"},{"action":"removeLines","range":{"start":{"row":34,"column":0},"end":{"row":40,"column":0}},"nl":"\n","lines":["","\tdef get_join_activities(self):","\t\tresult = []","\t\tactivity_requests = ActivityRequest.objects.filter(user_request=self.user,request_status=\"1\")","\t\tfor request in activity_requests:","\t\t\tresult.append(request.activity)"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":33,"column":0},"end":{"row":34,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":32,"column":37},"end":{"row":33,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":43,"column":0},"end":{"row":43,"column":14}},"text":"\t\treturn False"},{"action":"removeLines","range":{"start":{"row":34,"column":0},"end":{"row":43,"column":0}},"nl":"\n","lines":["\tdef is_following(self,username):","\t\ttry:","\t\t\tuser_follow = User.objects.get(username=username)","\t\t\tfor user in self.following.all():","\t\t\t\tif user.username == user_follow.username:","\t\t\t\t\treturn True","\t\t\treturn False","\t\texcept Exception as e:","\t\t\tlogger.exception(e)"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":33,"column":0},"end":{"row":34,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":32,"column":37},"end":{"row":33,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":13,"column":1},"end":{"row":13,"column":14}},"text":"date_of_birth"},{"action":"insertText","range":{"start":{"row":13,"column":1},"end":{"row":13,"column":2}},"text":"b"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":13,"column":2},"end":{"row":13,"column":3}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":13,"column":2},"end":{"row":13,"column":3}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":13,"column":2},"end":{"row":13,"column":3}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":13,"column":3},"end":{"row":13,"column":4}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":13,"column":4},"end":{"row":13,"column":5}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":13,"column":5},"end":{"row":13,"column":6}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":13,"column":6},"end":{"row":13,"column":7}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":13,"column":7},"end":{"row":13,"column":8}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":13,"column":8},"end":{"row":13,"column":9}},"text":"y"}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":18,"column":27},"end":{"row":18,"column":27},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1409348141164,"hash":"0c4736ee99ab68aaf4736901e9a10aae3c9b13d9"}