STOMP_DEBUG=false;if(STOMP_DEBUG){function getStompLogger(a){return{debug:function(){var b=Array.prototype.slice.call(arguments);b.unshift(a,": ");console.debug.apply(console,b)},dir:function(){console.debug(a,":");console.dir.apply(console,arguments)}}}}else{function getStompLogger(a){return{debug:function(){},dir:function(){}}}}LineProtocol=function(e){var c=getStompLogger("LineProtocol");var b=this;var a=null;var d=true;e.onopen=function(){a="";d=true;b.onopen()};e.onclose=function(f){a=null;b.onclose(f)};e.onerror=function(f){b.onerror(f)};e.onread=function(i){c.debug("transport.onread: enter isLineMode=",d," buffer[",a.length,"]=",a," data[",i.length,"]=",i);if(d){a+=i;i="";var j=0;var h;while((h=a.indexOf("\n",j))>=0&&d){var g=a.slice(j,h);var f=Orbited.utf8.decode(g)[0];c.debug("fire onlinereceived line[",f.length,"]=",f);b.onlinereceived(f);j=h+1}a=a.slice(j);if(d){}else{i=a;a=""}}if(i.length>0){c.debug("fire onrawdatareceived data[",i.length,"]=",i);b.onrawdatareceived(i)}c.debug("transport.onread: leave")};b.setRawMode=function(){c.debug("setRawMode");d=false};b.setLineMode=function(f){c.debug("setLineMode: extra=",f);d=true;if(f&&f.length>0){e.onread(f)}};b.send=function(f){c.debug("send: data=",f);return e.send(f)};b.open=function(g,f,h){c.debug("open: host=",g,":",f," isBinary=",h);e.open(g,f,h)};b.close=function(){c.debug("close");e.close()};b.reset=function(){e.reset()};b.onopen=function(){};b.onclose=function(){};b.onerror=function(f){};b.onlinereceived=function(f){};b.onrawdatareceived=function(f){}};STOMPClient=function(){var h=getStompLogger("STOMPClient");var n=this;var m=null;var i="";var k=null;var b=null;var d=null;n.user=null;function e(o){return o.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function a(q,p){for(var o in p){q[o]=p[o]}return q}function f(o){h.debug("protocol_onLineReceived: line=",o);if(o.length==0){if(k===null){return}h.debug("onLineReceived: all headers:");h.dir(b);if("content-length" in b){d=parseInt(b["content-length"])+1}else{d=null}m.setRawMode();return}if(k===null){h.debug("onLineReceived: begin ",o," frame");k=o;b={};i="";d=null;return}var p=o.search(":");var q=e(o.slice(0,p));var r=e(o.slice(p+1));b[q]=r;h.debug("onLineReceived: found header ",q,"=",r)}if(STOMP_DEBUG){function j(q,p){var o=[];for(var r=0;r<p.length;++r){o.push(p.charCodeAt(r))}h.debug(q);h.debug("length=",o.length," bytes=",o)}}else{function j(){}}function c(r){h.debug("protocol_onRawDataReceived");j("buffer",i);j("data",r);if(d===null){i+=r;var p=i.indexOf("\0");if(p>=0){var o=i.slice(0,p);i=i.slice(p+1);g(o,i)}}else{var q=Math.min(r.length,d);d-=q;if(d===0){var o=r.slice(0,q-1)}else{var o=r.slice(0,q)}r=r.slice(q);i+=o;if(d===0){g(i,r)}}}function g(p,o){h.debug("doDispatch: bytes[",p.length,"]=",p," extra[",o.length,"]=",o);j("bytes",p);j("extra",o);var q={type:k,headers:b,body:Orbited.utf8.decode(p)[0]};h.debug("doDispatch: end frame; body.length=",q.body.length);h.dir(q);n.onframe(q);i="";k=null;b={};d=null;m.setLineMode(o)}function l(){}n.onopen=l;n.onclose=l;n.onerror=l;n.onframe=function(o){switch(o.type){case"CONNECTED":n.onconnectedframe(o);break;case"MESSAGE":n.onmessageframe(o);break;case"RECEIPT":n.onreceiptframe(o);break;case"ERROR":n.onerrorframe(o);break;default:n.onerror("Unknown STOMP frame type "+o.type)}};n.onconnectedframe=l;n.onreceiptframe=l;n.onmessageframe=function(o){if(this.onmessage){this.onmessage(o)}};n.onerrorframe=l;n.onmessage=l;n.sendFrame=function(t,u,o){var s=[t];var q={};if(o&&u["content-length"]===undefined){if(u["content-type"]===undefined){s.push("content-type:text/plain");q["content-type"]=true}if(u["content-encoding"]===undefined){s.push("content-encoding:utf-8");q["content-encoding"]=true;o=Orbited.utf8.encode(o)}s.push("content-length:"+o.length);q["content-length"]=true}for(var r in u){if(!(r in q)){s.push(r+":"+u[r])}}s.push("\n");var p=Orbited.utf8.encode(s.join("\n"));if(o){p+=o}p+="\x00";m.send(p)};n.send_frame=n.sendFrame;n.connect=function(s,p,o,q){n.user=o;function r(){n.sendFrame("CONNECT",{login:o,passcode:q});n.onopen()}m=n._createProtocol();m.onopen=r;m.onclose=n.onclose;m.onerror=n.onerror;m.onlinereceived=f;m.onrawdatareceived=c;m.open(s,p,true)};n._createProtocol=function(){return new LineProtocol(new TCPSocket())};n.disconnect=function(){n.sendFrame("DISCONNECT")};n.reset=function(){m.reset()};n.send=function(p,o,q){n.sendFrame("SEND",a({destination:o},q),p)};n.subscribe=function(o,p){n.sendFrame("SUBSCRIBE",a({destination:o},p))};n.unsubscribe=function(o,p){n.sendFrame("UNSUBSCRIBE",a({destination:o},p))};n.begin=function(o){n.sendFrame("BEGIN",{transaction:o})};n.commit=function(o){n.sendFrame("COMMIT",{transaction:o})};n.abort=function(o){n.sendFrame("ABORT",{transaction:o})};n.ack=function(p,o){}};